{"version":3,"file":"c18858d4f0e320feb8b0.js","mappings":"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","sources":["webpack://LiveHelperChat/./src/lib/widgets/msgSnippetWidget.js"],"sourcesContent":["import {settings} from '../settings.js';\nimport {UIConstructorIframe} from '../UIConstructorIframe';\nimport {helperFunctions} from '../helperFunctions';\n\nexport class msgSnippetWidget{\n    constructor(prefix) {\n\n        this.attributes = {};\n        this.hidden = false;\n        this.widgetOpen = false;\n        this.invitationOpen = false;\n        this.nhOpen = false;\n\n        this.msop = null;   // Last operator ID who wrote a message\n        this.msg = null;    // Container of the message\n\n        this.cont = new UIConstructorIframe((prefix || 'lhc')+'_msgsnippet_widget_v2', helperFunctions.getAbstractStyle({\n            zindex: \"2147483639\",\n            width: \"300px\",\n            height: \"200px\",\n            position: \"fixed\",\n            display: \"none\",\n        }), null, \"iframe\");\n\n        this.loadStatus = {main : false, theme: false, status: false};\n    }\n\n    checkLoadStatus() {\n        if (this.loadStatus['theme'] == true && this.loadStatus['main'] == true && this.loadStatus['status'] == true) {\n            this.cont.elmDomDoc.body.style.display = \"\";\n            this.fitContent();\n        }\n    }\n\n    renderBody() {\n\n        this.cont.tmpl = this.msg.replace('{dev_type}',(this.attributes.isMobile === true ? 'lhc-mobile' : 'lhc-desktop')).replace('{msg_body}',this.settings['msg_body']).replace('{operator_profile}',this.settings['operator_profile']);\n\n        this.cont.bodyId = 'msgsnippet';\n\n        if (this.cont.constructUIIframe('', this.attributes.staticJS['dir']) === null){\n            return null;\n        }\n\n        // Content invisible untill media loads\n        this.cont.elmDomDoc.body.style.display = \"none\";\n\n        this.cont.elmDom.className += this.attributes.isMobile === true ? ' lhc-mobile' : ' lhc-desktop';\n\n        this.cont.attachUserEventListener(\"click\",  (e) => {\n            this.attributes.eventEmitter.emitEvent('msgSnippetClicked', [{'event': e, 'sender' : 'closeButton'}]);\n            this.attributes.eventEmitter.emitEvent('showWidget', [{'event': e}]);\n        }, \"start-chat-btn\",'msgsnippetstart');\n\n        var _that = this;\n\n        this.cont.attachUserEventListener(\"click\",  (a) => {\n            this.attributes.eventEmitter.emitEvent('msgsnippetClosed', [{'sender' : 'closeButton'}]);\n            a.stopPropagation();\n            _that.hide(true);\n        }, \"close-need-help-btn\",'msgsnippetclose');\n\n        this.cont.insertCssRemoteFile({onload: () => {this.loadStatus['main'] = true; this.checkLoadStatus()},crossOrigin : \"anonymous\",  href : this.attributes.staticJS['widget_css']}, true);\n\n        if (this.attributes.isMobile == true) {\n            this.cont.insertCssRemoteFile({crossOrigin : \"anonymous\",  href : this.attributes.staticJS['widget_mobile_css']});\n        }\n\n        if (this.attributes.theme) {\n            this.cont.insertCssRemoteFile({onload: () => {this.loadStatus['theme'] = true; this.checkLoadStatus()}, id : \"lhc-theme-msgsnippet\", crossOrigin : \"anonymous\",  href : this.attributes.LHC_API.args.lhc_base_url + '/widgetrestapi/theme/' + this.attributes.theme + '?v=' + this.attributes.theme_v}, true);\n        } else {\n            this.loadStatus['theme'] = true;\n            this.checkLoadStatus();\n        }\n\n        // Show need help only if status widget is loaded\n        this.attributes.sload.subscribe((data) => {if(data){this.loadStatus['status'] = true; this.checkLoadStatus()}});\n\n        this.attributes.eventEmitter.emitEvent('showMsgSnippet', [{'sender' : 'closeButton'}]);\n\n        this.attributes.eventEmitter.addListener('unread_message', (dataUnread) => {\n            if (dataUnread.msop) {\n                if (dataUnread.msop == this.msop && dataUnread.msg_body) {\n                    this.showSnippet(dataUnread, true);\n                } else {\n                    this.msop = dataUnread.msop;\n                    helperFunctions.makeRequest(this.attributes.LHC_API.args.lhc_base_url + this.attributes['lang'] + 'widgetrestapi/getmessagesnippet', {params: this.attributes['userSession'].getSessionAttributes()}, (data) => {\n                        this.msop = data.msop;\n                        this.msg = data.msg;\n                        this.showSnippet(data, true);\n                    })\n                }\n            }\n        });\n\n        this.attributes.eventEmitter.addListener('hide_msg_snippet', () => {\n            this.hide(true);\n        });\n\n        this.attributes.widgetStatus.subscribe((data) => {\n            data == true ? (this.widgetOpen = true, this.hide(true)) : (this.widgetOpen = false, this.show());\n        });\n\n        this.attributes.eventEmitter.addListener('reloadWidget',() => {\n            this.cont.insertCssRemoteFile({onload: () => {this.loadStatus['theme'] = true; this.checkLoadStatus()}, id : \"lhc-theme-msgsnippet\", crossOrigin : \"anonymous\",  href : this.attributes.LHC_API.args.lhc_base_url + '/widgetrestapi/theme/' + this.attributes.theme + '?v=' + Date.now()}, true);\n        });\n    }\n\n    init(attributes, settings) {\n        this.attributes = attributes;\n        this.settings = settings;\n\n        if (this.settings['msg']) {\n            this.msg = this.settings['msg'];\n        }\n\n        if (this.settings['msop']) {\n            this.msop = this.settings['msop'];\n        }\n\n        if (!this.msg || (this.settings['msop'] && this.msop !== this.settings['msop'])) {\n            helperFunctions.makeRequest(this.attributes.LHC_API.args.lhc_base_url + this.attributes['lang'] + 'widgetrestapi/getmessagesnippet', {params: this.attributes['userSession'].getSessionAttributes()}, (data) => {\n                this.msop = data.msop;\n                this.msg = data.msg;\n                this.settings['operator_profile'] = data.operator_profile;\n                this.renderBody();\n            })\n        } else {\n            this.renderBody();\n        }\n\n    }\n\n    hide (persistent) {\n\n        if (typeof persistent !== 'undefined' && persistent === true) {\n            this.hidden = true;\n        }\n\n        this.cont.hide();\n\n        if (this.nhOpen == true) {\n            this.attributes.eventEmitter.emitEvent('msgSnippetHide', []);\n        }\n\n        this.attributes.msgsnippet_status.next(false);\n        this.nhOpen = false;\n    }\n\n    showSnippet(data, showSnippet) {\n        if (showSnippet == true) {\n            this.hidden = false;\n            this.show();\n        }\n        this.cont.elmDomDoc.getElementById('messages-scroll').innerHTML = data.msg_body;\n\n        if (data.operator_profile) {\n            this.cont.elmDomDoc.getElementById('operator-profile-snippet').innerHTML = data.operator_profile;\n        }\n\n        this.fitContent();\n    }\n\n    fitContent() {\n\n        var documentHeight = this.cont.elmDomDoc.getElementById('messages-scroll').offsetHeight;\n\n        var placement = {bottom: (70 + this.attributes.widgetDimesions.value.wbottom - (91 - documentHeight)) +\"px\", right: (65+this.attributes.widgetDimesions.value.wright) + \"px\"};\n\n        var leftPosition = false;\n\n        if (this.attributes.position_placement == 'bottom_left' || this.attributes.position_placement == 'full_height_left') {\n            placement = {bottom: (70 + this.attributes.widgetDimesions.value.wbottom - (91 - documentHeight)) +\"px\", left: (65+this.attributes.widgetDimesions.value.wright) + \"px\"};\n            leftPosition = true;\n        } else if (this.attributes.position_placement == 'middle_left') {\n            placement = {bottom: \"calc(50% + 35px)\", left: (65+this.attributes.widgetDimesions.value.wright) + \"px\"};\n            leftPosition = true;\n        } else if (this.attributes.position_placement == 'middle_right') {\n            placement = {bottom: \"calc(50% + 35px)\", right: (65+this.attributes.widgetDimesions.value.wright) + \"px\"};\n        }\n\n        this.cont.massRestyle(placement);\n    }\n\n    show () {\n        if (this.hidden == true || this.widgetOpen == true || this.invitationOpen == true || this.attributes.onlineStatus.value == false) {\n            return;\n        }\n\n        if (this.attributes.hideOffline === false) {\n            this.cont.show();\n            if (this.nhOpen == false) {\n                this.attributes.eventEmitter.emitEvent('msgSnippetShow', []);\n                this.attributes.msgsnippet_status.next(true);\n            }\n            this.nhOpen = true;\n        } else {\n            this.cont.hide();\n            if (this.nhOpen == true) {\n                this.attributes.eventEmitter.emitEvent('msgSnippetHide', []);\n                this.attributes.msgsnippet_status.next(false);\n            }\n            this.nhOpen = false;\n        }\n    }\n}"],"names":["msgSnippetWidget","prefix","_classCallCheck","this","attributes","hidden","widgetOpen","invitationOpen","nhOpen","msop","msg","cont","UIConstructorIframe","helperFunctions","getAbstractStyle","zindex","width","height","position","display","loadStatus","main","theme","status","_createClass","key","value","elmDomDoc","body","style","fitContent","_this","tmpl","replace","isMobile","settings","bodyId","constructUIIframe","staticJS","elmDom","className","attachUserEventListener","e","eventEmitter","emitEvent","_that","a","stopPropagation","hide","insertCssRemoteFile","onload","checkLoadStatus","crossOrigin","href","id","LHC_API","args","lhc_base_url","theme_v","sload","subscribe","data","addListener","dataUnread","msg_body","showSnippet","makeRequest","params","getSessionAttributes","widgetStatus","show","Date","now","_this2","operator_profile","renderBody","persistent","msgsnippet_status","next","getElementById","innerHTML","documentHeight","offsetHeight","placement","bottom","widgetDimesions","wbottom","right","wright","position_placement","left","massRestyle","onlineStatus","hideOffline"],"sourceRoot":""}