{"version":3,"file":"ba4b61183be361c773c1.js","mappings":"4iCAAuD,IAEjDA,EAAW,SAAAC,GAEb,SAAAD,KAAcE,EAAAA,EAAAA,GAAA,KAAAF,GACVG,KAAKC,OAAS,CAAC,EACfD,KAAKE,WAAa,KAClBF,KAAKG,WAAa,IACtB,CA8EC,OA9EAC,EAAAA,EAAAA,GAAAP,EAAA,EAAAQ,IAAA,YAAAC,MAAA,SAAAC,EAAAC,EAAAC,GAAA,OAAAX,EAAAA,IAAAY,EAAAA,EAAAA,GAAAC,IAAAA,MAED,SAAAC,EAAgBX,EAAQC,EAAYC,GAAU,IAAAU,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EA+CjCC,EAWMC,EAAkB,OAAAhB,IAAAA,MAAC,SAADiB,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,OA9BT,OA8BTH,EAAkB,kBAAAd,EAAAA,IAAAH,EAAAA,EAAAA,GAAAC,IAAAA,MAAjC,SAAAoB,IAAA,IAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAAC,EAAA,OAAA3B,IAAAA,MAAA,SAAA4B,GAAA,cAAAA,EAAAV,KAAAU,EAAAT,MAAA,OAEkD,GAD1CE,EAA4B,MAAjBZ,EACfA,EAAgBH,EAAOuB,UAAU,MAAQ1B,GACzB,GAAZkB,EAAgB,CAAAO,EAAAT,KAAA,SAAAS,EAAAV,KAAA,EAAAI,GAAA,EAAAC,GAAA,EAAAK,EAAAV,KAAA,EAAAO,EAAAK,EAESrB,GAAa,cAAAmB,EAAAT,KAAA,GAAAM,EAAAN,OAAA,aAAAG,IAAAI,EAAAE,EAAAG,MAAAC,MAAA,CAAAJ,EAAAT,KAAA,SACjB,kBADFQ,EAAED,EAAA/B,OACNgC,GACHpC,EAAW0C,aAAaC,UAAU,wBAClB,aAATP,EAAGA,IACVrB,EAAO6B,gBAAgB,OAAO3B,EAAY,CAACmB,GAAG,YAAaS,QAAQ,EAAMjC,IAAKA,IACjF,QAAAmB,GAAA,EAAAM,EAAAT,KAAA,gBAAAS,EAAAT,KAAA,iBAAAS,EAAAV,KAAA,GAAAU,EAAAS,GAAAT,EAAA,SAAAL,GAAA,EAAAC,EAAAI,EAAAS,GAAA,WAAAT,EAAAV,KAAA,GAAAU,EAAAV,KAAA,IAAAI,GAAA,MAAAG,EAAAa,OAAA,CAAAV,EAAAT,KAAA,gBAAAS,EAAAT,KAAA,GAAAM,EAAAa,SAAA,WAAAV,EAAAV,KAAA,IAAAK,EAAA,CAAAK,EAAAT,KAAA,eAAAK,EAAA,eAAAI,EAAAW,OAAA,mBAAAX,EAAAW,OAAA,YAAAX,EAAAT,KAAA,iBAAAS,EAAAV,KAAA,GAAAU,EAAAY,GAAAZ,EAAA,kCAAAA,EAAAa,OAAA,GAAArB,EAAA,6CAMhBsB,MAAA,KAAAC,UAAA,EA3BQ5B,EAAc,WAAG,IAAA6B,EACtBC,EAAAA,EAAgBC,YAAYvD,EAAWwD,QAAQC,KAAKC,aAAe1D,EAAiB,KAAI,4BAA6B,CAAED,OAAQ,CAAC4D,IAAK,IAAIC,MAAQC,aAAa,SAAFC,GAAA,OAAAT,EAAAA,IAAA7C,EAAAA,EAAAA,GAAAC,IAAAA,MAAE,SAAAsD,EAAOC,GAAI,OAAAvD,IAAAA,MAAA,SAAAwD,GAAA,cAAAA,EAAAtC,KAAAsC,EAAArC,MAAA,OACtI,OAA/BX,EAAc+C,EAAK/C,YAAYgD,EAAArC,KAAA,EACzBsC,QAAQC,IAAI,CACdpD,EAAOqD,OAAO,QAAQ,CAACC,KAAML,EAAKK,KAAMrD,WAAYA,EAAYC,YAAa+C,EAAK/C,cAClFF,EAAOuD,SAAS,gBAAgBC,SAClC,OACF9C,IAAqB,wBAAAwC,EAAAf,OAAA,GAAAa,EAAA,MACxBZ,MAAA,KAAAC,UAAA,GACL,EAvDAtD,KAAKC,OAASA,EACdD,KAAKE,WAAaA,EAClBF,KAAKG,WAAaA,EAEZW,EAAMd,KAAKE,WAAWwE,YAAYC,SAEpC5D,EAAgB,CAChB6D,gBAAiB,EACjBC,SAAU5E,EAAO4E,SACjBC,KAAM7E,EAAO6E,KACbC,cAAe,8BAGA,IAAf9E,EAAO+E,OACPjE,EAAciE,KAAOC,SAAShF,EAAO+E,OAGpB,GAAjB/E,EAAOiF,SACPnE,EAAcmE,QAAS,GAGvBlE,EAAgBmE,EAAQ,MAExBlE,EAASD,EAAcoE,OAAOrE,GAE9BG,EAAa,MAAQJ,EACrBK,EAAcnB,KAAKE,WAAWiB,YAC9BC,EAAgB,KAAIQ,EAAAE,KAAA,GAELb,EAAOuD,SAAS,WAAWC,OAAM,QAA1C7C,EAAAc,KACC2C,iBACP1D,IACAzB,EAAWwD,QAAQC,KAAK2B,gBAAiB,GAEzC5D,IACHE,EAAAC,KAAA,GAAAR,GAAA,EAAAC,GAAA,EAAAM,EAAAC,KAAA,GAAAL,EAAAiB,EAG2BxB,EAAOuD,SAAS,mBAAiB,eAAA5C,EAAAE,KAAA,GAAAN,EAAAM,OAAA,aAAAT,IAAAI,EAAAG,EAAAc,MAAAC,MAAA,CAAAf,EAAAE,KAAA,SAArCL,EAAAnB,MAChBoB,IAAiB,QAAAL,GAAA,EAAAO,EAAAE,KAAA,iBAAAF,EAAAE,KAAA,iBAAAF,EAAAC,KAAA,GAAAD,EAAAoB,GAAApB,EAAA,UAAAN,GAAA,EAAAC,EAAAK,EAAAoB,GAAA,WAAApB,EAAAC,KAAA,GAAAD,EAAAC,KAAA,IAAAR,GAAA,MAAAG,EAAAyB,OAAA,CAAArB,EAAAE,KAAA,gBAAAF,EAAAE,KAAA,GAAAN,EAAAyB,SAAA,WAAArB,EAAAC,KAAA,IAAAP,EAAA,CAAAM,EAAAE,KAAA,eAAAP,EAAA,eAAAK,EAAAsB,OAAA,mBAAAtB,EAAAsB,OAAA,YAAAtB,EAAAE,KAAA,iBAAAF,EAAAC,KAAA,GAAAD,EAAAuB,GAAAvB,EAAA,mCAAAA,EAAAwB,OAAA,GAAAxC,EAAA,+CAoC5ByC,MAAA,KAAAC,UAAA,KAAAzD,CAAA,CApFY,GAuFX0F,EAAa,IAAI1F,C","sources":["webpack://LiveHelperChat/./src/util/nodeJSChat.js"],"sourcesContent":["import {helperFunctions} from '../lib/helperFunctions';\n\nclass _nodeJSChat {\n\n    constructor() {\n        this.params = {};\n        this.attributes = null;\n        this.chatEvents = null;\n    }\n\n    async setParams(params, attributes, chatEvents) {\n        this.params = params;\n        this.attributes = attributes;\n        this.chatEvents = chatEvents;\n\n        const vid = this.attributes.userSession.getVID();\n\n        var socketOptions = {\n            protocolVersion: 1,\n            hostname: params.hostname,\n            path: params.path,\n            authTokenName: 'socketCluster.authToken_vi'\n        }\n\n        if (params.port != '') {\n            socketOptions.port = parseInt(params.port);\n        }\n\n        if (params.secure == 1) {\n            socketOptions.secure = true;\n        }\n\n        var socketCluster = require(\"socketcluster-client\");\n\n        var socket = socketCluster.create(socketOptions);\n\n        var chanelName = 'uo_' + vid;\n        var instance_id = this.attributes.instance_id;\n        var sampleChannel = null;\n\n        let status = await socket.listener('connect').once();\n        if (status.isAuthenticated) {\n            connectSiteVisitor();\n            attributes.LHC_API.args.check_messages = false;\n        } else {\n            authentificate();\n        }\n\n        try {\n            for await (let event of socket.listener('deauthenticate')) {\n                authentificate();\n            }\n        } catch (e) {\n            // shut up old browers\n        }\n\n\n        function authentificate() {\n            helperFunctions.makeRequest(attributes.LHC_API.args.lhc_base_url + attributes['lang'] + \"nodejshelper/tokenvisitor\", { params: {ts: (new Date()).getTime()}}, async (data) => {\n                instance_id = data.instance_id;\n                await Promise.all([\n                    socket.invoke('login',{hash: data.hash, chanelName: chanelName, instance_id: data.instance_id}),\n                    socket.listener('authenticate').once()\n                ]);\n                connectSiteVisitor();\n            })\n        }\n\n        async function connectSiteVisitor() {\n            var firstRun = sampleChannel == null;\n            sampleChannel = socket.subscribe('uo_' + vid);\n            if (firstRun == true) {\n                try {\n                    for await (let op of sampleChannel) {\n                        if (op.op == 'check_message') {\n                            attributes.eventEmitter.emitEvent('checkMessageOperator');\n                        } else if (op.op == 'is_online') {\n                            socket.transmitPublish('ous_'+instance_id,{op:'vi_online', status: true, vid: vid});\n                        }\n                    }\n                } catch (e){\n                    // shut up old browsers\n                }\n            }\n        }\n\n    }\n}\n\nconst nodeJSChat = new _nodeJSChat();\nexport {nodeJSChat};\n\n"],"names":["_nodeJSChat","_setParams","_classCallCheck","this","params","attributes","chatEvents","_createClass","key","value","_x","_x2","_x3","_asyncToGenerator","_regeneratorRuntime","_callee3","_connectSiteVisitor","vid","socketOptions","socketCluster","socket","chanelName","instance_id","sampleChannel","_iteratorAbruptCompletion","_didIteratorError","_iteratorError","_iterator","_step","authentificate","connectSiteVisitor","_context3","prev","next","_callee2","firstRun","_iteratorAbruptCompletion2","_didIteratorError2","_iteratorError2","_iterator2","_step2","op","_context2","subscribe","_asyncIterator","sent","done","eventEmitter","emitEvent","transmitPublish","status","t0","return","finish","t1","stop","apply","arguments","_ref","helperFunctions","makeRequest","LHC_API","args","lhc_base_url","ts","Date","getTime","_x4","_callee","data","_context","Promise","all","invoke","hash","listener","once","userSession","getVID","protocolVersion","hostname","path","authTokenName","port","parseInt","secure","require","create","isAuthenticated","check_messages","nodeJSChat"],"sourceRoot":""}