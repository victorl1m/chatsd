"use strict";(self.webpackChunkLHCVoiceCallAPP=self.webpackChunkLHCVoiceCallAPP||[]).push([[860],{9860:(e,t,a)=>{a.r(t),a.d(t,{default:()=>y});var n=a(5398),i=a(3925),r=a(1093),c=a(1202),s=a.n(c),l=a(1902),o=a(514),u=a.n(o),d=a(4067);var m=a(8633),p=a.n(m);const v=function(e){var t=(0,l.useState)(!1),a=(0,i.Z)(t,2),n=a[0],r=a[1];return(0,l.useEffect)((function(){e.user.videoTrack.play("player-"+e.user.uid)}),[]),l.createElement("div",{className:(n?"col-12":"col")+" bg-light m-0 align-middle text-center d-flex p-0",id:"player-"+e.user.uid,title:"UID "+e.user.uid},l.createElement("div",{className:"full-screen-icon",onClick:function(e){return r(!n)}},l.createElement("span",{className:"material-icons"},n?"fullscreen_exit":"fullscreen")))},_=function(e){var t=(0,d.$G)("voice_call"),a=t.t;return t.i18n,1==e.video?l.createElement(v,{user:e.user,key:"video-stream-"+e.user.uid}):l.createElement("div",{className:"col bg-light m-0 align-middle text-center d-flex p-0",id:"player-"+e.user.uid,title:"UID "+e.user.uid},l.createElement("div",{className:"align-self-center mx-auto text-muted font-weight-bold",title:"UID "+e.user.uid},l.createElement("span",{className:"material-icons"},"graphic_eq"),a("voice_call.audio_call")))};function f(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function b(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?f(Object(a),!0).forEach((function(t){(0,r.Z)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):f(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var k=p().createClient({mode:"rtc",codec:"vp8"});function h(e,t){switch(t.type){case"update":return b(b({},e),t.value);case"user_published":if(void 0===e.remoteUsers[t.user.uid]){var a={user:t.user,video:"video"==t.media,audio:"audio"==t.media,media:[t.media]};e.remoteUsers[t.user.uid]=a}else"audio"==t.media?e.remoteUsers[t.user.uid].audio=!0:"video"==t.media&&(e.remoteUsers[t.user.uid].video=!0),e.remoteUsers[t.user.uid].media.push(t.media);return b({},e);case"user_update":return void 0!==e.remoteUsers[t.user.uid]&&("audio"==t.media?e.remoteUsers[t.user.uid].audio=!1:"video"==t.media&&(e.remoteUsers[t.user.uid].video=!1),e.remoteUsers[t.user.uid]),b({},e);case"user_unpublished":return delete e.remoteUsers[t.user.uid],b({},e);default:throw new Error("Unknown action!")}}const y=function(e){var t=(0,l.useReducer)(h,{call:{},localTracks:{videoTrack:null,audioTrack:null},hasAudio:!1,hasVideo:!1,screenShare:!1,remoteUsers:{},uid:null,inCall:!1,pendingJoin:!1,type:"",isMuted:!1}),a=(0,i.Z)(t,2),r=a[0],c=a[1],o=(0,l.useRef)(r);(0,l.useEffect)((function(){o.current=r}),[r]),(0,l.useEffect)((function(){g(),p().getDevices().then((function(e){var t=e.filter((function(e){return"audioinput"===e.kind})),a=e.filter((function(e){return"videoinput"===e.kind}));c({type:"update",value:{hasAudio:t.length>0,hasVideo:a.length>0}})}))}),[]);var m,v,f,b=(0,d.$G)("voice_call"),y=b.t,T=(b.i18n,function(t){var a;a=!0===e.isVisitor?WWW_DIR_JAVASCRIPT+"voicevideo/join/"+e.initParams.id+"/"+e.initParams.hash+"/(action)/request":WWW_DIR_JAVASCRIPT+"voicevideo/joinop/"+e.initParams.id+"/(action)/join",u().post(a,{type:t}).then((function(e){c({type:"update",value:{call:e.data,type:t,pendingJoin:!0}})}))}),E=function(){var t=(0,n.Z)(s().mark((function t(a){var n;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null,n=!0===e.isVisitor?WWW_DIR_JAVASCRIPT+"voicevideo/join/"+e.initParams.id+"/"+e.initParams.hash+"/(action)/"+a:WWW_DIR_JAVASCRIPT+"voicevideo/joinop/"+e.initParams.id+"//(action)/"+a,u().get(n).then((function(e){c({type:"update",value:{call:e.data}})})),"leave"!=a&&"end"!=a&&"cancel"!=a){t.next=8;break}return Object.keys(r.localTracks).forEach((function(e){var t=r.localTracks[e];t&&(t.stop(),t.close(),r.localTracks[e]=void 0)})),c({type:"update",value:{remoteUsers:{},uid:null,inCall:!1,localTracks:{videoTrack:null,audioTrack:null}}}),t.next=8,k.leave();case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),x=function(){null!==r.localTracks.audioTrack&&(r.localTracks.audioTrack.setEnabled(r.isMuted),c({type:"update",value:{isMuted:!r.isMuted}}))},g=function(){var t;t=!0===e.isVisitor?WWW_DIR_JAVASCRIPT+"voicevideo/join/"+e.initParams.id+"/"+e.initParams.hash:WWW_DIR_JAVASCRIPT+"voicevideo/joinop/"+e.initParams.id,u().get(t).then((function(e){c({type:"update",value:{call:e.data}})}))};m=function(){g()},v=2!=r.call.status||2!=r.call.vi_status||1!=r.call.op_status?2e3:null,f=(0,l.useRef)(),(0,l.useEffect)((function(){f.current=m}),[m]),(0,l.useEffect)((function(){if(null!==v){var e=setInterval((function(){f.current()}),v);return function(){return clearInterval(e)}}}),[v]);var C=function(){var e=(0,n.Z)(s().mark((function e(t,a){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.uid,e.next=3,k.subscribe(t,a);case 3:c({type:"user_published",media:a,user:t}),"audio"===a&&t.audioTrack.play();case 5:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),N=function(e,t){C(e,t)},P=function(e){c({type:"user_unpublished",user:e}),g()},V=function(e,t){c({type:"user_update",media:t,user:e})};(0,l.useEffect)((function(){!0===e.isVisitor&&1==r.pendingJoin&&(2===r.call.vi_status?U(r.call):!0===r.inCall&&2!==r.call.vi_status&&E("cancel"))}),[r.call.vi_status,r.pendingJoin]),(0,l.useEffect)((function(){1===r.call.op_status&&!1===e.isVisitor&&!1===r.inCall&&1==r.pendingJoin&&U(r.call)}),[r.call.op_status,r.pendingJoin]);var w=function(){var e=(0,n.Z)(s().mark((function e(){var t,a,n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(1!=r.screenShare){e.next=11;break}if(!(t=r.localTracks).videoTrack){e.next=7;break}return e.next=5,k.unpublish(t.videoTrack);case 5:t.videoTrack.stop(),t.videoTrack.close();case 7:return t.videoTrack=null,c({type:"update",value:{inCall:!0,screenShare:!1,localTracks:t}}),"audiovideo"==r.type&&j(),e.abrupt("return");case 11:return e.prev=11,e.next=14,p().createScreenVideoTrack();case 14:if(a=e.sent,n=r.localTracks,!r.localTracks.videoTrack){e.next=21;break}return e.next=19,k.unpublish(r.localTracks.videoTrack);case 19:r.localTracks.videoTrack.stop(),r.localTracks.videoTrack.close();case 21:return n.videoTrack=a,n.videoTrack.play("local-player"),c({type:"update",value:{inCall:!0,screenShare:!0,localTracks:n}}),e.next=26,k.publish(a);case 26:e.next=31;break;case 28:e.prev=28,e.t0=e.catch(11),alert("Screen could not be shared!");case 31:case"end":return e.stop()}}),e,null,[[11,28]])})));return function(){return e.apply(this,arguments)}}(),j=function(){var e=(0,n.Z)(s().mark((function e(){var t,a,n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.localTracks.videoTrack||null===r.localTracks.videoTrack){e.next=12;break}if(!(t=r.localTracks).videoTrack){e.next=7;break}return e.next=5,k.unpublish(t.videoTrack);case 5:t.videoTrack.stop(),t.videoTrack.close();case 7:return t.videoTrack=null,c({type:"update",value:{inCall:!0,type:"audio",localTracks:t}}),e.abrupt("return");case 12:return e.next=14,p().createCameraVideoTrack();case 14:return a=e.sent,(n=r.localTracks).videoTrack=a,n.videoTrack.play("local-player"),c({type:"update",value:{inCall:!0,type:"audiovideo",localTracks:n}}),e.next=21,k.publish(a);case 21:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),S=function(){var t;t=!0===e.isVisitor?WWW_DIR_JAVASCRIPT+"voicevideo/join/"+e.initParams.id+"/"+e.initParams.hash+"/(action)/token":WWW_DIR_JAVASCRIPT+"voicevideo/joinop/"+e.initParams.id+"//(action)/token",u().get(t).then((function(e){c({type:"update",value:{call:e.data}}),k.renewToken(e.data.token)}))},U=function(){var t=(0,n.Z)(s().mark((function t(a){var n,i;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!0!==r.inCall&&(!0!==e.isVisitor||2==a.vi_status)){t.next=2;break}return t.abrupt("return");case 2:return k.on("user-published",N),k.on("user-unpublished",V),k.on("user-left",P),k.on("token-privilege-will-expire",S),t.next=8,k.join(e.initParams.appid,e.initParams.id+"_"+e.initParams.hash,a.token||null);case 8:return n=t.sent,t.next=11,p().createMicrophoneAudioTrack();case 11:if(t.t0=t.sent,i={audioTrack:t.t0},"audiovideo"!=r.type&&(1!=e.isVisitor||1!=r.call.video)){t.next=18;break}return t.next=16,p().createCameraVideoTrack();case 16:i.videoTrack=t.sent,i.videoTrack.play("local-player");case 18:return c({type:"update",value:{uid:n,inCall:!0,localTracks:i}}),t.next=21,k.publish(Object.values(i));case 21:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return l.createElement(l.Fragment,null,l.createElement("div",{className:"d-flex flex-md-row flex-column flex-grow-1 pt-0"},l.createElement("div",{className:"col bg-light m-0 align-middle text-center d-flex p-0",title:"UID "+r.uid,id:"local-player"},1==e.isVisitor&&1==r.call.vi_status&&l.createElement("div",{className:"align-self-center mx-auto text-muted font-weight-bold"},y("voice_call.wait_join_long")),null==r.localTracks.videoTrack&&1==r.inCall&&l.createElement("div",{className:"align-self-center mx-auto text-muted font-weight-bold"},l.createElement("span",{className:"material-icons"},"graphic_eq"),y("voice_call.me_audio"))),1==r.inCall&&Object.keys(r.remoteUsers).map((function(e,t){return l.createElement(_,{user:r.remoteUsers[e].user,key:"media_"+r.remoteUsers[e].user.uid+"_"+r.remoteUsers[e].media.join("_"),audio:r.remoteUsers[e].audio,video:r.remoteUsers[e].video,media:r.remoteUsers[e].media})}))),l.createElement("div",{className:"row border-top"},l.createElement("div",{className:"btn-toolbar p-2 text-center mx-auto btn-toolbar",role:"toolbar"},l.createElement("div",{className:"p-2 text-center mx-auto btn-group",role:"group"},1==e.isVisitor&&1==r.call.vi_status&&l.createElement("span",{className:"text-muted py-2"},y("voice_call.wait_let_in")," "),1==e.isVisitor&&(0==r.call.vi_status||!1===r.pendingJoin)&&l.createElement("span",{className:"text-muted py-2"},y("voice_call.join_to_start")," "),0==e.isVisitor&&2==r.call.vi_status&&l.createElement("span",{className:"text-muted py-2"},y("voice_call.visitor_joined")),0==e.isVisitor&&0==r.call.vi_status&&l.createElement("span",{className:"text-muted py-2"},y("voice_call.pending_visitor_join")),0==e.isVisitor&&1==r.call.vi_status&&l.createElement("span",{className:"text-muted py-2"},y("voice_call.visitor_waiting_in"))),l.createElement("div",{className:"p-2 text-center mx-auto btn-group",role:"group"},0==e.isVisitor&&""!=r.call.token&&1==r.call.vi_status&&l.createElement("button",{className:"btn btn-sm btn-outline-primary",onClick:function(){return E("letvisitorin")}},l.createElement("span",{className:"material-icons"},"face"),y("voice_call.let_visitor_in")),0==e.isVisitor&&1==r.inCall&&l.createElement(l.Fragment,null,l.createElement("button",{title:y("voice_call.leave_a_call"),className:"btn btn-sm btn-outline-secondary",onClick:function(){return E("leave")}},l.createElement("span",{className:"material-icons"},"exit_to_app"),y("voice_call.leave_call_op")),l.createElement("button",{title:y("voice_call.end_call_op"),className:"btn btn-sm btn-outline-secondary",onClick:function(){return E("end")}},l.createElement("span",{className:"material-icons"},"call_end"),y("voice_call.end_call_button")),l.createElement("button",{title:1==r.isMuted?y("voice_call.unmute_mic"):y("voice_call.mute_mic"),className:"btn btn-sm btn-outline-secondary",onClick:function(){return x()}},l.createElement("span",{className:"material-icons mr-0"},1==r.isMuted?"mic_off":"mic")),1==e.initParams.options.video&&!0===r.hasVideo&&l.createElement("button",{className:"btn btn-sm btn-outline-secondary",disabled:r.screenShare,onClick:function(){return j()},title:"audio"==r.type?y("voice_call.share_video"):y("voice_call.stop_sharing_video")},l.createElement("span",{className:"material-icons mr-0"},"audio"==r.type||1==r.screenShare?"videocam_off":"videocam")),1==e.initParams.options.screenshare&&l.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:function(){return w()},title:1==r.screenShare?y("voice_call.stop_share_screen"):y("voice_call.share_your_screen")},l.createElement("span",{className:"material-icons mr-0"},1==r.screenShare?"stop_screen_share":"screen_share"))),(0==e.isVisitor&&0==r.call.op_status||1==e.isVisitor&&0==r.call.vi_status||0==r.pendingJoin)&&l.createElement(l.Fragment,null,!0===r.hasAudio&&l.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:function(){return T("audio")}},l.createElement("span",{className:"material-icons"},"call"),y("voice_call.join_with_audio")),1==e.initParams.options.video&&!0===r.hasVideo&&l.createElement("button",{className:"btn btn-sm btn-outline-secondary",onClick:function(){return T("audiovideo")}},l.createElement("span",{className:"material-icons"},"video_call"),y("voice_call.join_with_audio_video"))),1==e.isVisitor&&1==r.inCall&&l.createElement(l.Fragment,null,l.createElement("button",{className:"btn btn-outline-primary btn-sm",onClick:function(){return E("cancel")}},l.createElement("span",{className:"material-icons"},"call_end"),y("voice_call.leave_room")),l.createElement("button",{title:1==r.isMuted?y("voice_call.unmute_mic"):y("voice_call.mute_mic"),className:"btn btn-outline-secondary btn-sm",onClick:function(){return x()}},l.createElement("span",{className:"material-icons mr-0"},1==r.isMuted?"mic_off":"mic")),1==e.initParams.options.video&&!0===r.hasVideo&&l.createElement("button",{disabled:r.screenShare,className:"btn btn-outline-secondary btn-sm",onClick:function(){return j()},title:"audio"==r.type?y("voice_call.share_video"):y("voice_call.stop_sharing_video")},l.createElement("span",{className:"material-icons mr-0"},"audio"==r.type||1==r.screenShare?"videocam_off":"videocam")),1==e.initParams.options.screenshare&&l.createElement("button",{className:"btn btn-outline-secondary btn-sm",onClick:function(){return w()},title:1==r.screenShare?y("voice_call.stop_share_screen"):y("voice_call.share_your_screen")},l.createElement("span",{className:"material-icons mr-0"},1==r.screenShare?"stop_screen_share":"screen_share"))),1==e.isVisitor&&!0===r.pendingJoin&&1==r.call.vi_status&&l.createElement("button",{className:"btn btn-outline-primary btn-sm",onClick:function(){return E("cancel")}},y("voice_call.cancel_join"))))))}}}]);
//# sourceMappingURL=860.05bda154e60825305368.js.map